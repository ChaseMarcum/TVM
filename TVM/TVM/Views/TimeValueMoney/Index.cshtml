@model TVM.Models.TimeValueMoney

@{
    ViewBag.Title = "Index";
    var myEquation = new TVM.Models.TimeValueMoney();
}

<div style="padding: 30px"></div>

<div class="jumbotron">

    <h2>@myEquation.name</h2>
    <br />
    <h4>@myEquation.description</h4>
    <br />
    <div class="form-horizontal" role="form">
        <div class="table-responsive">
            <table class="table">
                <tr class="text-center">
                    <td>
                        <h4>
                            @myEquation.firstVariableName
                        </h4>
                    </td>
                    <td>
                        <h4>
                            @myEquation.secondVariableName
                        </h4>
                    </td>
                    <td>
                        <h4>
                            @myEquation.thirdVariableName
                        </h4>
                    </td>
                    <td>
                        <h4>
                            @myEquation.fourthVariableName
                        </h4>
                    </td>
                    <td>
                        <h4>
                            @myEquation.fifthVariableName
                        </h4>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input class="form-control " id="NPER" type="number" />
                    </td>
                    <td>
                        <input class="form-control " id="RATE" type="number" />
                    </td>
                    <td>
                        <input class="form-control" id="PV" type="number" />
                    </td>
                    <td>
                        <input class="form-control" id="PMT" type="number" />
                    </td>
                    <td>
                        <input class="form-control" id="FV" type="number" />
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <button name="Process" onclick="processEquation()" type="button" class="btn btn-default btn-lg btn-block">Calculate Missing Value</button>
</div>

<script>
    function processEquation() {
        var NPER = document.getElementById("NPER").value * 1;
        var RATE = document.getElementById("RATE").value * 1;
        var PV = document.getElementById("PV").value * 1;
        var PMT = document.getElementById("PMT").value * 1;
        var FV = document.getElementById("FV").value * 1;
        var returnType = null;
        var returnAddOn = "";
        var normalize = 1;
        var returnValue = 0;


        if (document.getElementById("NPER").value == "") {
            var tempNPER = 0;
            for (var a = 0; a < 1000;) {
                var tempReturnValue = -PV;
                tempReturnValue = (tempReturnValue) * Math.pow((1 + RATE), a);
                for (var i = a - 1; i >= 0; i--) {
                    tempReturnValue += -PMT * Math.pow((1 + RATE), i);
                }
                
                if (tempReturnValue < FV) {
                    tempNPER = a;
                }

                a += 1;

            }
            //alert(tempNPER);

            var tempNPER2 = 0;
            tempNPER = tempNPER * 1000;
            alert(tempNPER);
            var tempRATE = RATE / 1000;
            var tempPMT = PMT / 1000;
            for (var a = tempNPER; a < tempNPER + 1000;) {
                var tempReturnValue = -PV;
                tempReturnValue = (tempReturnValue) * Math.pow((1 + tempRATE), a);
                //alert(tempReturnValue);
                //alert(a);
                for (var i = a-1; i >= 0; i--) {
                    tempReturnValue += -tempPMT * Math.pow((1 + tempRATE), i);
                   // alert(i);
                }

                if (tempReturnValue < FV) {
                    tempNPER2 = a;
                }

                a += 1;

            }

            
            alert(tempNPER2);
            tempNPER2 = tempNPER2 /1000;




            NPER = tempNPER2;
            NPER = NPER.toFixed(2);

            document.getElementById("NPER").value = NPER;


            //do NPER equation
        }
        else if (document.getElementById("RATE").value == "") {
            var tempRate = 0;

            for (var a = 0; a < 10;) {
                var tempReturnValue = -PV;
                tempReturnValue = (tempReturnValue) * Math.pow((1 + a), NPER);
                for (var i = NPER - 1; i >= 0; i--) {
                    tempReturnValue += -PMT * Math.pow((1 + a), i);
                }
                if (tempReturnValue < FV) {
                    tempRate = a;
                }
                a += .1;
            }
            var tempRate2 = 0;

            for (var a = tempRate; a < tempRate + .1;) {
                var tempReturnValue = -PV;
                tempReturnValue = (tempReturnValue) * Math.pow((1 + a), NPER);
                for (var i = NPER - 1; i >= 0; i--) {
                    tempReturnValue += -PMT * Math.pow((1 + a), i);
                }
                if (tempReturnValue < FV) {
                    tempRate2 = a;
                }

                a += .01;
            }
            var tempRate3 = 0;

            for (var a = tempRate2; a < tempRate2 + .01;) {
                var tempReturnValue = -PV;
                tempReturnValue = (tempReturnValue) * Math.pow((1 + a), NPER);
                for (var i = NPER - 1; i >= 0; i--) {
                    tempReturnValue += -PMT * Math.pow((1 + a), i);
                }
                if (tempReturnValue < FV) {
                    tempRate3 = a;
                }

                a += .001;
            }

            tempRate3 = tempRate3.toFixed(2);
            document.getElementById("RATE").value = tempRate3;




            //simple code here
            //returnValue = Math.pow((FV / PV), (1 / NPER)) - 1;

            //returnValue = returnValue.toFixed(4);
            //document.getElementById("RATE").value = returnValue;
            //do RATE equation
        }
        else if (document.getElementById("PV").value == "") {
            //do PV equation
        }
        else if (document.getElementById("PMT").value == "") {
            returnValue = ((((PV * Math.pow((RATE + 1), NPER)) + FV) * RATE) / (1 - (Math.pow((1 + RATE), NPER))));

            returnValue = returnValue.toFixed(2);
            document.getElementById("PMT").value = returnValue;
            //do PMT equation
        }
        else if (document.getElementById("FV").value == "") {
            returnValue = -PV;
            returnValue = (returnValue) * Math.pow((1 + RATE), NPER);
            for (var a = NPER - 1; a >= 0; a--) {
                returnValue += -PMT * Math.pow((1 + RATE), a);
            }
            returnValue = returnValue.toFixed(2);
            document.getElementById("FV").value = returnValue;
        }
    }
</script>
